<%- include('../includes/adminHeader') %>
    <div class="container my-4">
        <!-- Text Area Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>Internship Details</h5>
            </div>
            <div class="card-body">
                <textarea id="internshipJobDescription" class="form-control mb-3" rows="4"
                    placeholder="Enter the internship details here"></textarea>
                <button onclick="fillForm()" class="btn btn-primary">Fill the form</button>
                <span id="loader"></span>
            </div>
        </div>

        <!-- Job Post Form Section -->
        <div class="card">
            <div class="card-header">
                <h5>Job Post Form</h5>
            </div>
            <div class="card-body">
                <form action="/submit-job-post" method="POST" enctype="multipart/form-data">
                    <!-- Job Information -->
                    <div class="mb-3">
                        <label for="jobTitle" class="form-label">Job Title</label>
                        <input type="text" class="form-control" id="jobTitle" name="jobTitle" required>
                    </div>
                    <div class="mb-3">
                        <label for="companyName" class="form-label">Company Name</label>
                        <input type="text" class="form-control" id="companyName" name="companyName" required>
                    </div>
                    <div class="mb-3">
                        <label for="companyLogo" class="form-label">Company Logo</label>
                        <input type="file" class="form-control" id="companyLogo" name="companyLogo">
                    </div>
                    <div class="mb-3">
                        <label for="companyWebsite" class="form-label">Company Website</label>
                        <input type="url" class="form-control" id="companyWebsite" name="companyWebsite">
                    </div>
                    <div class="mb-3">
                        <label for="jobLocation" class="form-label">Job Location</label>
                        <input type="text" class="form-control" id="jobLocation" name="jobLocation">
                    </div>
                    <div class="mb-3">
                        <label for="remoteWork" class="form-label">Remote Work</label>
                        <select class="form-control" id="remoteWork" name="remoteWork">
                            <option value="true">Yes</option>
                            <option value="false">No</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="jobType" class="form-label">Job Type</label>
                        <input type="text" class="form-control" id="jobType" name="jobType">
                    </div>

                    <!-- Job Description and Requirements -->
                    <div class="mb-3">
                        <label for="jobDescription" class="form-label">Job Description</label>
                        <textarea class="form-control" id="jobDescription" name="jobDescription" rows="4"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="responsibilities" class="form-label">Responsibilities</label>
                        <textarea class="form-control" id="responsibilities" name="responsibilities"
                            rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="qualifications" class="form-label">Qualifications</label>
                        <textarea class="form-control" id="qualifications" name="qualifications" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="skillsRequired" class="form-label">Skills Required</label>
                        <textarea class="form-control" id="skillsRequired" name="skillsRequired" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="experienceRequired" class="form-label">Experience Required</label>
                        <input type="text" class="form-control" id="experienceRequired" name="experienceRequired">
                    </div>
                    <div class="mb-3">
                        <label for="educationRequired" class="form-label">Education Required</label>
                        <input type="text" class="form-control" id="educationRequired" name="educationRequired">
                    </div>
                    <div class="mb-3">
                        <label for="salaryRange" class="form-label">Salary Range</label>
                        <input type="text" class="form-control" id="salaryRange" name="salaryRange">
                    </div>
                    <div class="mb-3">
                        <label for="benefits" class="form-label">Benefits</label>
                        <textarea class="form-control" id="benefits" name="benefits" rows="3"></textarea>
                    </div>

                    <!-- Application Information -->
                    <div class="mb-3">
                        <label for="applicationDeadline" class="form-label">Application Deadline</label>
                        <input type="date" class="form-control" id="applicationDeadline" name="applicationDeadline">
                    </div>
                    <div class="mb-3">
                        <label for="eligibility" class="form-label">Eligibility</label>
                        <input type="text" class="form-control" id="eligibility" name="eligibility">
                    </div>
                    <div class="mb-3">
                        <label for="applicationInstructions" class="form-label">Application Instructions</label>
                        <textarea class="form-control" id="applicationInstructions" name="applicationInstructions"
                            rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="applicationLink" class="form-label">Application Link</label>
                        <input type="url" class="form-control" id="applicationLink" name="applicationLink">
                    </div>

                    <!-- Task Details -->
                    <div class="mb-3">
                        <label for="taskTitle" class="form-label">Task Title</label>
                        <input type="text" class="form-control" id="taskTitle" name="taskTitle">
                    </div>
                    <div class="mb-3">
                        <label for="TaskDesc" class="form-label">Task Description</label>
                        <textarea class="form-control" id="TaskDesc" name="TaskDesc" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="taskToBeCompleted" class="form-label">Task to Be Completed</label>
                        <textarea class="form-control" id="taskToBeCompleted" name="taskToBeCompleted"
                            rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="TaskDeadline" class="form-label">Task Deadline</label>
                        <input type="date" class="form-control" id="TaskDeadline" name="TaskDeadline">
                    </div>
                    <div class="mb-3">
                        <label for="TaskSubmissionLink" class="form-label">Task Submission Link</label>
                        <input type="url" class="form-control" id="TaskSubmissionLink" name="TaskSubmissionLink">
                    </div>

                    <!-- Contact Information -->
                    <div class="mb-3">
                        <label for="contactPerson" class="form-label">Contact Person</label>
                        <input type="text" class="form-control" id="contactPerson" name="contactPerson">
                    </div>
                    <div class="mb-3">
                        <label for="contactEmail" class="form-label">Contact Email</label>
                        <input type="email" class="form-control" id="contactEmail" name="contactEmail">
                    </div>
                    <div class="mb-3">
                        <label for="contactPhone" class="form-label">Contact Phone</label>
                        <input type="tel" class="form-control" id="contactPhone" name="contactPhone">
                    </div>

                    <!-- Additional Information -->
                    <div class="mb-3">
                        <label for="extraNotes" class="form-label">Extra Notes</label>
                        <textarea class="form-control" id="extraNotes" name="extraNotes" rows="3"></textarea>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        async function fillForm() {
            // alert('Filling the form')
             document.getElementById('loader').innerHTML = '<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>';

            const input = document.getElementById('internshipJobDescription').value

            


            //convert the below code to fetch
            console.log("Thinking...");
            fetch('http://localhost:4000/llm/ask-llm', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ input: input })
            })
                .then(response => response.json()) // First parse main response as JSON
                .then(responseData => {
                    if (!responseData.success || !responseData.data) {
                        console.error("Invalid response:", responseData);
                        return;
                    }

                    const rawData = responseData.data; // This is the string containing JSON inside
                    console.log("Raw LLM Response:", rawData);
                    console.log("Raw LLM Response:", rawData.jobTitle);
                    // console.log("Raw LLM Response:",JSON.parse(rawData).jobTitle);



                    // **Extract JSON inside the triple backticks**
                    // const jsonMatch = rawData.match(/```json\n([\s\S]*?)\n```/);
                    // if (!jsonMatch) {
                    //     console.error("No valid JSON found in response:", rawData);
                    //     return;
                    // }

                    // let data;
                    // try {
                    //     data = JSON.parse(jsonMatch[1]); // Extract and parse JSON
                    // } catch (error) {
                    //     console.error("Error parsing JSON:", error, jsonMatch[1]);
                    //     return;
                    // }

                    // console.log("Extracted JSON:", data); // Verify extracted data

                    // // Function to get value or empty string if null/N/A
                    // function getValue(key) {
                    //     return data[key] && data[key] !== "N/A" ? data[key] : "";
                    // }
                    //remove loader
                   document.getElementById('loader').innerHTML = '';

                    // Fill form fields
                    document.getElementById("jobTitle").value = rawData.jobTitle;
                    document.getElementById("companyName").value = rawData.companyName;
                    document.getElementById("jobLocation").value = rawData.jobLocation;
                    document.getElementById("jobType").value = rawData.jobType;
                    document.getElementById("jobDescription").value = rawData.jobDescription;
                    document.getElementById("experienceRequired").value = rawData.experienceRequired;
                    document.getElementById("educationRequired").value = rawData.educationRequired;
                    document.getElementById("salaryRange").value = rawData.salaryRange;
                    document.getElementById("companyWebsite").value = rawData.companyWebsite;
                    document.getElementById("responsibilities").value = rawData.responsibilities;
                    document.getElementById("qualifications").value = rawData.qualifications;
                    document.getElementById("skillsRequired").value = rawData.skillsRequired;
                    document.getElementById("benefits").value = rawData.benefits;
                    document.getElementById("applicationDeadline").value = rawData.applicationDeadline;
                    document.getElementById("eligibility").value = rawData.eligibility;
                    document.getElementById("applicationInstructions").value = rawData.applicationInstructions;
                    document.getElementById("applicationLink").value = rawData.applicationLink;
                    document.getElementById("taskTitle").value = rawData.taskTitle;
                    document.getElementById("TaskDesc").value = rawData.TaskDesc;
                    document.getElementById("taskToBeCompleted").value = rawData.taskToBeCompleted;
                    document.getElementById("TaskDeadline").value = rawData.TaskDeadline;
                    document.getElementById("TaskSubmissionLink").value = rawData.TaskSubmissionLink;
                    document.getElementById("contactPerson").value = rawData.contactPerson;
                    document.getElementById("contactEmail").value = rawData.contactEmail;


                })
                .catch(error => {
                    console.error(error);
                });

        }
    </script>

    <%- include('../includes/studentFooter') %>